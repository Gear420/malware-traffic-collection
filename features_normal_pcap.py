# !/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2021/7/9 9:38 下午
# @Author  : Gear
import os

filename = "train_tcp.csv"
f = open(filename, "a+")
file_list = []


def walkFile(file):
	for root, dirs, files in os.walk(file):
		for f in files:
			file_list.append(f)


def save(features, label):
	for l in features:
		f.write(str(l))
		f.write('\t')
	f.write(label)
	f.write('\n')


from flowcontainer.extractor import extract

walkFile('normal_pcap')
submit_file_list = []
for file in file_list:
	submit_file_list.append("normal_pcap/" + file)
print(submit_file_list)

label = '0'
sum_len = 0
sum_flows = 0

for file in submit_file_list:
	result = extract(file, filter='tcp',
	                 extension=["tls.handshake.extensions_server_name", "tls.handshake.ciphersuite"])
	flows += len(result)
	for key in result:
		value = result[key]
		dur_time = value.time_end - value.time_start
		print(dur_time)
		
		len_to_sum = []
		lens = value.payload_lengths
		for leni in lens:
			if leni < 0:
				len_to_sum.append(-leni)
			else:
				len_to_sum.append(leni)
		print(len_to_sum)
		
		sum = 0
		for leni in len_to_sum:
			sum += leni
		print(sum)
		len_sum = sum
		features = [dur_time, len_sum]
		save(features, label)