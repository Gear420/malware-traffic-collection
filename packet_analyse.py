#!/usr/bin/env python
# -*- coding: utf-8 -*-
# @Time    : 2021/7/10 3:20 下午
# @Author  : Gear
import dpkt
import socket

file = 'example.pcap'
with open(file, 'rb') as fr:
    pcap = dpkt.pcap.Reader(fr)
    for timestamp, buffer in pcap:
        ethernet = dpkt.ethernet.Ethernet(buffer)
        # 仅需要TCP的包
        if not isinstance(ethernet.data, dpkt.ip.IP):
            continue
        ip = ethernet.data
        if not isinstance(ip.data, dpkt.tcp.TCP):
            continue
        tcp = ip.data
        print(tcp)
        # 过滤掉内容为空的包
        if len(tcp.data) == 0:
            continue
        # 发送方的IP
        src = socket.inet_ntoa(ip.src)
        print(src)
        # 接收方的IP
        dst = socket.inet_ntoa(ip.dst)
        # 报文内容（byte数组)
        byteArray = tcp.data
        print(byteArray)